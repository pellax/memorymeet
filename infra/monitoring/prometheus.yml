# ================================================================================================
# üìä PROMETHEUS CONFIGURATION - M2PRD-001 SaaS Monitoring
# ================================================================================================
# Configuraci√≥n de Prometheus para recolecci√≥n de m√©tricas de todos los servicios

global:
  scrape_interval: 15s          # Recolecci√≥n cada 15 segundos
  evaluation_interval: 15s       # Evaluaci√≥n de reglas cada 15 segundos
  scrape_timeout: 10s           # Timeout de scraping
  
  # Labels externos a√±adidos a todas las m√©tricas
  external_labels:
    cluster: 'memorymeet-dev'
    environment: 'development'

# Configuraci√≥n de Alertmanager (para futuro)
# alerting:
#   alertmanagers:
#     - static_configs:
#         - targets:
#           - alertmanager:9093

# Reglas de alertas (para futuro)
# rule_files:
#   - "alerts/*.yml"

# ================================================================================================
# üéØ SCRAPE CONFIGS - Targets de Recolecci√≥n
# ================================================================================================

scrape_configs:
  
  # ===== üìä Prometheus self-monitoring =====
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
        labels:
          service: 'prometheus'
          component: 'monitoring'
  
  # ===== üí∞ Backend Gatekeeper (RF8.0) - CR√çTICO =====
  - job_name: 'backend-gatekeeper'
    scrape_interval: 10s          # M√°s frecuente por ser cr√≠tico
    metrics_path: '/metrics'
    static_configs:
      - targets: ['backend:8000']
        labels:
          service: 'consumption-gatekeeper'
          component: 'backend'
          priority: 'critical'      # Servicio cr√≠tico RF8.0
          rf: 'RF8.0'
    
    # Relabeling para mejor organizaci√≥n
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
        replacement: 'backend-gatekeeper'
  
  # ===== ü§ñ IA/NLP Module (RF3.0, RF4.0) =====
  - job_name: 'ia-nlp-module'
    scrape_interval: 15s
    metrics_path: '/metrics'
    static_configs:
      - targets: ['ia_module:8003']
        labels:
          service: 'ia-nlp-microservice'
          component: 'ai-processing'
          priority: 'high'
          rf: 'RF3.0+RF4.0'
    
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
        replacement: 'ia-nlp-module'
  
  # ===== üíæ PostgreSQL (Database Metrics) =====
  # Nota: Requiere postgres_exporter - se a√±adir√° en el futuro
  # - job_name: 'postgresql'
  #   static_configs:
  #     - targets: ['postgres-exporter:9187']
  #       labels:
  #         service: 'postgresql'
  #         component: 'database'
  #         priority: 'critical'
  
  # ===== ‚ö° Redis (Cache Metrics) =====
  # Nota: Requiere redis_exporter - se a√±adir√° en el futuro
  # - job_name: 'redis'
  #   static_configs:
  #     - targets: ['redis-exporter:9121']
  #       labels:
  #         service: 'redis'
  #         component: 'cache'
  #         priority: 'high'
  
  # ===== üìä n8n Orchestrator =====
  # Nota: n8n expone m√©tricas en /metrics si est√° configurado
  # - job_name: 'n8n-orchestrator'
  #   static_configs:
  #     - targets: ['n8n:5678']
  #       labels:
  #         service: 'n8n'
  #         component: 'orchestration'
  #         priority: 'high'

# ================================================================================================
# üîß ADVANCED CONFIGURATION
# ================================================================================================

# Configuraci√≥n de almacenamiento
storage:
  tsdb:
    path: /prometheus
    retention:
      time: 15d              # Retenci√≥n de 15 d√≠as
      size: 10GB             # M√°ximo 10GB de almacenamiento

# Configuraci√≥n de remote write (para futuro - env√≠o a storage externo)
# remote_write:
#   - url: "http://remote-storage:9009/api/v1/push"
#     queue_config:
#       capacity: 10000
#       max_shards: 50
